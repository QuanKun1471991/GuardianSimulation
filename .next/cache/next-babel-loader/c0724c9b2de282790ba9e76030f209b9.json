{"ast":null,"code":"var _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport { useEffect, useState } from \"react\";\nimport VectorSource from \"ol/source/Vector\";\nimport { Icon, Text, Fill, Stroke, Style, Circle } from \"ol/style\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport VectorLayer from \"ol/layer/Vector\";\nimport LayerGroup from \"ol/layer/Group\";\nimport { formatPortFeatures } from \"core/model/Map\";\nimport produce from \"immer\";\nvar labelLayerDisplayZoomLevel = 5;\nvar labelLayerScaleZoomLevel = 5;\nvar portLayerScaleZoomLevel = 5;\nvar portForecastStyle = new Style({\n  image: new Icon({\n    src: \"/icons/com_icons.png\",\n    size: [29, 29],\n    offset: [123, 12],\n    scale: 0.2\n  })\n});\nvar portNonForecastStyle = new Style({\n  image: new Circle({\n    radius: 2,\n    fill: new Fill({\n      color: [63, 144, 255]\n    })\n  })\n});\nvar labelStyle = new Style({\n  text: new Text({\n    textAlign: \"center\",\n    textBaseline: \"bottom\",\n    font: \"Bold 15px/3 arial\",\n    fill: new Fill({\n      color: \"white\"\n    }),\n    backgroundFill: new Fill({\n      color: [63, 144, 255]\n    }),\n    backgroundStroke: new Stroke({\n      color: \"white\"\n    }),\n    padding: [0, 5, 0, 5],\n    offsetY: -15\n  })\n});\nvar portLayer = new VectorLayer({\n  source: new VectorSource({\n    format: new GeoJSON()\n  })\n});\nvar labelLayer = new VectorLayer({\n  source: new VectorSource({\n    format: new GeoJSON()\n  })\n});\nvar layer = new LayerGroup({\n  layers: [portLayer, labelLayer]\n});\n\nvar Index = function Index(_ref) {\n  _s();\n\n  var selectedPort = _ref.selectedPort,\n      portList = _ref.portList,\n      guardianMap = _ref.guardianMap;\n\n  var _useState = useState(guardianMap.getView().getZoom()),\n      currentZoom = _useState[0],\n      setCurrentZoom = _useState[1];\n\n  useEffect(function () {\n    if (portList.length === 0) {\n      return;\n    }\n\n    var portSource = portLayer.getSource();\n    var labelSource = labelLayer.getSource();\n    var portDataFeatures = selectedPort ? portList.filter(function (_ref2) {\n      var id = _ref2.properties.id;\n      return id === selectedPort.id;\n    }) : portList;\n    var labelDataFeatures = portDataFeatures.map(function (item) {\n      return produce(item, function (draft) {\n        draft.properties.click_disabled = true;\n      });\n    });\n    portSource.addFeatures(formatPortFeatures(portDataFeatures));\n    labelSource.addFeatures(formatPortFeatures(labelDataFeatures)); // eslint-disable-next-line consistent-return\n\n    return function clearUp() {\n      portSource.clear();\n      labelSource.clear();\n    };\n  }, [selectedPort, portList]);\n\n  var reStylesPortLayer = function reStylesPortLayer() {\n    var source = portLayer.getSource();\n    var features = source.getFeatures();\n    features.map(function (feature) {\n      var zoom = guardianMap.getView().getZoom();\n      var scale = zoom > portLayerScaleZoomLevel ? 0.5 : 0.4;\n      var newPortForecastStyle = portForecastStyle.clone();\n      newPortForecastStyle.getImage().setScale(scale);\n      var newPortNonForecastStyle = portNonForecastStyle.clone();\n      feature.setStyle(feature.get(\"has_port_forecast\") ? newPortForecastStyle : newPortNonForecastStyle);\n    });\n  };\n\n  var reStylesLabelLayer = function reStylesLabelLayer() {\n    var labelSource = labelLayer.getSource();\n    var features = labelSource.getFeatures();\n    features.map(function (feature) {\n      var zoom = guardianMap.getView().getZoom();\n      var scale = zoom > labelLayerScaleZoomLevel ? 0.4 : 0.2;\n      var newLabelStyle = labelStyle.clone();\n      var text = newLabelStyle.getText();\n      text.setText(zoom > labelLayerDisplayZoomLevel ? feature.getProperties().name : \"\");\n      text.setScale(scale * 1.5);\n      feature.setStyle(newLabelStyle);\n    });\n  };\n\n  useEffect(function () {\n    reStylesPortLayer();\n  }, [portList, guardianMap, reStylesPortLayer]);\n  useEffect(function () {\n    reStylesLabelLayer();\n  }, [portList, guardianMap]);\n  guardianMap.on(\"moveend\", function () {\n    var zoom = guardianMap.getView().getZoom();\n\n    if (zoom > labelLayerDisplayZoomLevel && currentZoom < labelLayerDisplayZoomLevel || zoom < labelLayerDisplayZoomLevel && currentZoom > labelLayerDisplayZoomLevel) {\n      reStylesLabelLayer();\n    }\n\n    setCurrentZoom(zoom);\n  });\n  useEffect(function () {\n    guardianMap.addLayer(layer);\n  }, [guardianMap]);\n  return null;\n};\n\n_s(Index, \"r1kwB9c6ALWUEaX1Wv8Xn3swV78=\");\n\n_c = Index;\nexport default Index;\n\nvar _c;\n\n$RefreshReg$(_c, \"Index\");","map":{"version":3,"sources":["/Users/tonysan/Desktop/guardian-simulation/GuardianSimulation/src/components/Layers/Port/index.tsx"],"names":["useEffect","useState","VectorSource","Icon","Text","Fill","Stroke","Style","Circle","GeoJSON","VectorLayer","LayerGroup","formatPortFeatures","produce","labelLayerDisplayZoomLevel","labelLayerScaleZoomLevel","portLayerScaleZoomLevel","portForecastStyle","image","src","size","offset","scale","portNonForecastStyle","radius","fill","color","labelStyle","text","textAlign","textBaseline","font","backgroundFill","backgroundStroke","padding","offsetY","portLayer","source","format","labelLayer","layer","layers","Index","selectedPort","portList","guardianMap","getView","getZoom","currentZoom","setCurrentZoom","length","portSource","getSource","labelSource","portDataFeatures","filter","id","properties","labelDataFeatures","map","item","draft","click_disabled","addFeatures","clearUp","clear","reStylesPortLayer","features","getFeatures","feature","zoom","newPortForecastStyle","clone","getImage","setScale","newPortNonForecastStyle","setStyle","get","reStylesLabelLayer","newLabelStyle","getText","setText","getProperties","name","on","addLayer"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport { useEffect, useState } from \"react\"\nimport Map from \"ol/Map\"\nimport VectorSource from \"ol/source/Vector\"\nimport { Icon, Text, Fill, Stroke, Style, Circle } from \"ol/style\"\nimport GeoJSON from \"ol/format/GeoJSON\"\nimport VectorLayer from \"ol/layer/Vector\"\nimport LayerGroup from \"ol/layer/Group\"\nimport { formatPortFeatures, FeaturesProfile } from \"core/model/Map\"\nimport produce from \"immer\"\nimport { Feature } from \"ol\"\n\nconst labelLayerDisplayZoomLevel = 5\nconst labelLayerScaleZoomLevel = 5\nconst portLayerScaleZoomLevel = 5\n\nconst portForecastStyle = new Style({\n  image: new Icon({\n    src: \"/icons/com_icons.png\",\n    size: [29, 29],\n    offset: [123, 12],\n    scale: 0.2,\n  }),\n})\nconst portNonForecastStyle = new Style({\n  image: new Circle({\n    radius: 2,\n    fill: new Fill({ color: [63, 144, 255] }),\n  }),\n})\n\nconst labelStyle = new Style({\n  text: new Text({\n    textAlign: \"center\",\n    textBaseline: \"bottom\",\n    font: \"Bold 15px/3 arial\",\n    fill: new Fill({ color: \"white\" }),\n    backgroundFill: new Fill({ color: [63, 144, 255] }),\n    backgroundStroke: new Stroke({ color: \"white\" }),\n    padding: [0, 5, 0, 5],\n    offsetY: -15,\n  }),\n})\n\nconst portLayer = new VectorLayer({\n  source: new VectorSource({\n    format: new GeoJSON(),\n  }),\n})\n\nconst labelLayer = new VectorLayer({\n  source: new VectorSource({\n    format: new GeoJSON(),\n  }),\n})\nconst layer = new LayerGroup({\n  layers: [portLayer, labelLayer],\n})\n\ninterface PortLayerProps {\n  guardianMap: Map\n  portList: []\n  selectedPort: Record<string, unknown>\n}\n\nconst Index = ({ selectedPort, portList, guardianMap }: PortLayerProps) => {\n  const [currentZoom, setCurrentZoom] = useState(guardianMap.getView().getZoom())\n  useEffect(() => {\n    if (portList.length === 0) {\n      return\n    }\n\n    const portSource = portLayer.getSource()\n    const labelSource = labelLayer.getSource()\n\n    const portDataFeatures = selectedPort\n      ? portList.filter(({ properties: { id } }: any) => id === selectedPort.id)\n      : portList\n\n    const labelDataFeatures = portDataFeatures.map((item: FeaturesProfile) =>\n      produce(item, (draft) => {\n        draft.properties.click_disabled = true\n      })\n    )\n\n    portSource.addFeatures(formatPortFeatures(portDataFeatures))\n    labelSource.addFeatures(formatPortFeatures(labelDataFeatures))\n\n    // eslint-disable-next-line consistent-return\n    return function clearUp() {\n      portSource.clear()\n      labelSource.clear()\n    }\n  }, [selectedPort, portList])\n\n  const reStylesPortLayer = () => {\n    const source = portLayer.getSource()\n    const features = source.getFeatures()\n    features.map((feature) => {\n      const zoom = guardianMap.getView().getZoom()\n      const scale = zoom > portLayerScaleZoomLevel ? 0.5 : 0.4\n      const newPortForecastStyle = portForecastStyle.clone()\n      newPortForecastStyle.getImage().setScale(scale)\n      const newPortNonForecastStyle = portNonForecastStyle.clone()\n      feature.setStyle(\n        feature.get(\"has_port_forecast\") ? newPortForecastStyle : newPortNonForecastStyle\n      )\n    })\n  }\n\n  const reStylesLabelLayer = () => {\n    const labelSource = labelLayer.getSource()\n    const features = labelSource.getFeatures()\n    features.map((feature) => {\n      const zoom = guardianMap.getView().getZoom()\n      const scale = zoom > labelLayerScaleZoomLevel ? 0.4 : 0.2\n      const newLabelStyle = labelStyle.clone()\n      const text = newLabelStyle.getText()\n      text.setText(zoom > labelLayerDisplayZoomLevel ? feature.getProperties().name : \"\")\n      text.setScale(scale * 1.5)\n      feature.setStyle(newLabelStyle)\n    })\n  }\n\n  useEffect(() => {\n    reStylesPortLayer()\n  }, [portList, guardianMap, reStylesPortLayer])\n\n  useEffect(() => {\n    reStylesLabelLayer()\n  }, [portList, guardianMap])\n\n  guardianMap.on(\"moveend\", () => {\n    const zoom = guardianMap.getView().getZoom()\n    if (\n      (zoom > labelLayerDisplayZoomLevel && currentZoom < labelLayerDisplayZoomLevel) ||\n      (zoom < labelLayerDisplayZoomLevel && currentZoom > labelLayerDisplayZoomLevel)\n    ) {\n      reStylesLabelLayer()\n    }\n    setCurrentZoom(zoom)\n  })\n\n  useEffect(() => {\n    guardianMap.addLayer(layer)\n  }, [guardianMap])\n\n  return null\n}\n\nexport default Index\n"]},"metadata":{},"sourceType":"module"}