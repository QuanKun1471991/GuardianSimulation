{"ast":null,"code":"import _compact from \"lodash/compact\";\nvar _jsxFileName = \"/Users/tonysan/Desktop/guardian-simulation/GuardianSimulation/src/components/Layers/SimulationRoutes/index.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useDispatch } from 'react-redux';\nimport { useEffect, useState } from 'react';\nimport React from 'react';\nimport SimulationSettings from 'components/SimulationSettings';\nimport { convertCoord2LongLat, convertHeadingtoDegree, convertLongLat2Coords } from 'core/model/Map';\nimport { formatDateTimeUTC, YYYY_MM_DD_HH_MM_SS } from 'core/utils/datetime';\nimport moment from 'moment';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport { simulationFormatMessage, aisFakeMessage } from 'core/model/Vessel';\nimport { BaseFunctions } from \"services/vessel/actions\";\nconst vectorSource = new ol.source.Vector({\n  format: new ol.format.GeoJSON()\n});\n\nconst getRotation = (startPoint, endPoint) => {\n  const dx = endPoint[0] - startPoint[0];\n  const dy = endPoint[1] - startPoint[1];\n  return -Math.atan2(dy, dx);\n};\n\nconst styleFunction = feature => {\n  const geometry = feature.getGeometry();\n  const styles = [// linestring\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: '#ffcc33',\n      width: 2\n    })\n  })];\n  geometry.forEachSegment(function (start, end) {\n    const rotation = getRotation(start, end);\n    console.log('rotation' + rotation); // arrows\n\n    styles.push(new ol.style.Style({\n      geometry: new ol.geom.Point(end),\n      image: new ol.style.Icon({\n        src: 'icons/arrow.png',\n        anchor: [0.75, 0.5],\n        rotateWithView: true,\n        rotation: rotation\n      })\n    }));\n  });\n  return styles;\n};\n\nfunction Index({\n  guardianMap,\n  selectedVessel\n}) {\n  const dispatch = useDispatch();\n  const {\n    0: currentFeature,\n    1: setCurrentFeature\n  } = useState(new ol.Feature());\n  const {\n    0: firstCoord,\n    1: setFirstCoord\n  } = useState(null);\n  const {\n    simulationRoutes: {\n      update,\n      data: SimulationRoutesData,\n      show: showSimulationRoutes\n    }\n  } = selectedVessel;\n  const createdAtTime = moment().toString();\n  const [openDialog, setOpenDialog] = React.useState(false);\n  const draw = new ol.interaction.Draw({\n    source: vectorSource,\n    type: 'LineString'\n  });\n  const simulationLayer = new ol.layer.Vector({\n    source: vectorSource,\n    style: styleFunction\n  });\n  useEffect(() => {\n    let increaseMinutes = 0;\n\n    if (showSimulationRoutes && selectedVessel.name) {\n      guardianMap.addLayer(simulationLayer);\n      guardianMap.addInteraction(draw);\n    }\n\n    if (!showSimulationRoutes) {\n      guardianMap.getInteractions().pop();\n      simulationLayer.getSource().clear();\n      guardianMap.removeLayer(simulationLayer);\n    }\n\n    draw.on('drawend', function (evt) {\n      const feature = evt.feature;\n      const coords = feature.getGeometry().getCoordinates();\n      setFirstCoord(coords[0]);\n      const simulationData = coords.map((coordinate, index) => {\n        if (index !== 0) {\n          const heading = convertHeadingtoDegree(getRotation(coords[index - 1], coordinate));\n          const longLatCoord = convertCoord2LongLat(coordinate);\n          const timeStamp = formatDateTimeUTC(moment(createdAtTime).add(increaseMinutes, 'minutes').toString(), YYYY_MM_DD_HH_MM_SS);\n          const message = simulationFormatMessage({\n            heading,\n            longLatCoord,\n            timeStamp\n          });\n          increaseMinutes += 5;\n          return message;\n        }\n      });\n      dispatch(BaseFunctions.setState({\n        field: \"selectedVessel\",\n        simulationRoutes: _objectSpread(_objectSpread({}, selectedVessel.simulationRoutes), {}, {\n          data: _compact(simulationData)\n        })\n      }));\n      setCurrentFeature(feature);\n    });\n  }, [showSimulationRoutes, selectedVessel.name]);\n  useEffect(() => {\n    if (currentFeature && update) {\n      const source = simulationLayer.getSource();\n      const coords = SimulationRoutesData.map(record => {\n        return convertLongLat2Coords([record.longitude, record.latitude]);\n      });\n      const updateCoords = [firstCoord].concat(coords);\n      const geometry = currentFeature.getGeometry();\n      geometry.setCoordinates(updateCoords);\n      source.clear();\n      source.addFeature(currentFeature);\n      const simulationData = geometry.getCoordinates().map((coordinate, index) => {\n        if (index !== 0) {\n          const heading = convertHeadingtoDegree(getRotation(updateCoords[index - 1], coordinate));\n          const longLatCoord = convertCoord2LongLat(coordinate);\n          const timeStamp = SimulationRoutesData[index - 1].timestamp;\n          const speed = SimulationRoutesData[index - 1].speed;\n          const created_at = SimulationRoutesData[index - 1].created_at;\n          const message = simulationFormatMessage({\n            heading,\n            longLatCoord,\n            timeStamp,\n            speed,\n            created_at\n          });\n          return message;\n        }\n      });\n      dispatch(BaseFunctions.setState({\n        field: \"selectedVessel\",\n        simulationRoutes: _objectSpread(_objectSpread({}, selectedVessel.simulationRoutes), {}, {\n          update: !update,\n          data: _compact(simulationData)\n        })\n      }));\n    }\n  }, [update]);\n\n  const handleClickClearDraw = () => {\n    guardianMap.getInteractions().pop();\n    guardianMap.addInteraction(draw);\n  };\n\n  const handleClickClearDrawLayer = () => {\n    simulationLayer.getSource().clear();\n    dispatch(BaseFunctions.setState({\n      field: \"selectedVessel\",\n      simulationRoutes: _objectSpread(_objectSpread({}, selectedVessel.simulationRoutes), {}, {\n        data: []\n      })\n    }));\n  };\n\n  const handleClickSend = () => {\n    simulationLayer.getSource().clear();\n    guardianMap.removeLayer(simulationLayer);\n    guardianMap.addLayer(simulationLayer);\n    console.log(JSON.stringify(aisFakeMessage(SimulationRoutesData)));\n    dispatch(BaseFunctions.setState({\n      field: \"selectedVessel\",\n      simulationRoutes: _objectSpread(_objectSpread({}, selectedVessel.simulationRoutes), {}, {\n        data: []\n      })\n    }));\n    setOpenDialog(false);\n  };\n\n  const handleCloseDialog = () => {\n    setOpenDialog(false);\n  };\n\n  const handleOpenDialog = () => {\n    setOpenDialog(true);\n  };\n\n  return __jsx(React.Fragment, null, __jsx(SimulationSettings, {\n    handleClickClearDraw: handleClickClearDraw,\n    handleClickClearDrawLayer: handleClickClearDrawLayer,\n    handleClickSend: handleOpenDialog,\n    show: showSimulationRoutes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }\n  }), __jsx(Dialog, {\n    open: openDialog,\n    onClose: handleCloseDialog,\n    \"aria-labelledby\": \"alert-dialog-title\",\n    \"aria-describedby\": \"alert-dialog-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 7\n    }\n  }, __jsx(DialogTitle, {\n    id: \"alert-dialog-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 9\n    }\n  }, 'Create Simulation Data Confirmation?'), __jsx(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }\n  }, __jsx(DialogContentText, {\n    id: \"alert-dialog-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 11\n    }\n  }, \"Please be aware that this simulation data will effect to voyage of current vessel, it is recommended to use on a fake vessel which is not belong to our customer, will you continue?\")), __jsx(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    onClick: handleCloseDialog,\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 11\n    }\n  }, \"Cancel\"), __jsx(Button, {\n    onClick: handleClickSend,\n    color: \"primary\",\n    autoFocus: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 11\n    }\n  }, \"Send\"))));\n}\n\nexport default Index;","map":{"version":3,"sources":["/Users/tonysan/Desktop/guardian-simulation/GuardianSimulation/src/components/Layers/SimulationRoutes/index.tsx"],"names":["useDispatch","useEffect","useState","React","SimulationSettings","convertCoord2LongLat","convertHeadingtoDegree","convertLongLat2Coords","formatDateTimeUTC","YYYY_MM_DD_HH_MM_SS","moment","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","simulationFormatMessage","aisFakeMessage","BaseFunctions","vectorSource","ol","source","Vector","format","GeoJSON","getRotation","startPoint","endPoint","dx","dy","Math","atan2","styleFunction","feature","geometry","getGeometry","styles","style","Style","stroke","Stroke","color","width","forEachSegment","start","end","rotation","console","log","push","geom","Point","image","Icon","src","anchor","rotateWithView","Index","guardianMap","selectedVessel","dispatch","currentFeature","setCurrentFeature","Feature","firstCoord","setFirstCoord","simulationRoutes","update","data","SimulationRoutesData","show","showSimulationRoutes","createdAtTime","toString","openDialog","setOpenDialog","draw","interaction","Draw","type","simulationLayer","layer","increaseMinutes","name","addLayer","addInteraction","getInteractions","pop","getSource","clear","removeLayer","on","evt","coords","getCoordinates","simulationData","map","coordinate","index","heading","longLatCoord","timeStamp","add","message","setState","field","record","longitude","latitude","updateCoords","concat","setCoordinates","addFeature","timestamp","speed","created_at","handleClickClearDraw","handleClickClearDrawLayer","handleClickSend","JSON","stringify","handleCloseDialog","handleOpenDialog"],"mappings":"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","sourcesContent":["import { connect, useDispatch } from 'react-redux';\nimport { useEffect, useState } from 'react';\nimport React from 'react';\nimport { flowRight, compact } from 'lodash';\nimport SimulationSettings from 'components/SimulationSettings';\nimport { convertCoord2LongLat, convertHeadingtoDegree, convertLongLat2Coords } from 'core/model/Map';\nimport { formatDateTimeUTC, YYYY_MM_DD_HH_MM_SS } from 'core/utils/datetime';\nimport moment from 'moment';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport { simulationFormatMessage, aisFakeMessage } from 'core/model/Vessel';\nimport Map from \"ol/Map\"\nimport {BaseFunctions} from \"services/vessel/actions\"\nimport VesselServices from \"services/vessel/api\"\n\n\n\n\nconst vectorSource = new ol.source.Vector({\n  format: new ol.format.GeoJSON(),\n});\n\nconst getRotation = (startPoint: any, endPoint: any) => {\n  const dx = endPoint[0] - startPoint[0];\n  const dy = endPoint[1] - startPoint[1];\n  return -Math.atan2(dy, dx);\n};\n\nconst styleFunction = (feature: any) => {\n  const geometry = feature.getGeometry();\n  const styles = [\n    // linestring\n    new ol.style.Style({\n      stroke: new ol.style.Stroke({\n        color: '#ffcc33',\n        width: 2,\n      }),\n    }),\n  ];\n\n  geometry.forEachSegment(function(start: any, end: any) {\n    const rotation = getRotation(start, end);\n    console.log('rotation' + rotation);\n    // arrows\n    styles.push(\n      new ol.style.Style({\n        geometry: new ol.geom.Point(end),\n        image: new ol.style.Icon({\n          src: 'icons/arrow.png',\n          anchor: [0.75, 0.5],\n          rotateWithView: true,\n          rotation: rotation,\n        }),\n      }),\n    );\n  });\n\n  return styles;\n};\n\ninterface simulationRoutesProps {\n  guardianMap: Map\n  selectedVessel: any\n}\n\nfunction Index({guardianMap , selectedVessel }: simulationRoutesProps) {\n  const dispatch = useDispatch()\n  const [currentFeature, setCurrentFeature] = useState(new ol.Feature());\n  const [firstCoord, setFirstCoord] = useState(null);\n  const {\n    simulationRoutes: { update, data: SimulationRoutesData, show:  showSimulationRoutes},\n  } = selectedVessel;\n  const createdAtTime = moment().toString();\n  const [openDialog, setOpenDialog] = React.useState(false);\n\n  const draw = new ol.interaction.Draw({\n    source: vectorSource,\n    type: 'LineString',\n  });\n\n  const simulationLayer = new ol.layer.Vector({\n    source: vectorSource,\n    style: styleFunction,\n  });\n\n  useEffect(() => {\n    let increaseMinutes = 0;\n    if (showSimulationRoutes && selectedVessel.name) {\n      guardianMap.addLayer(simulationLayer);\n      guardianMap.addInteraction(draw);\n    }\n    if (!showSimulationRoutes) {\n      guardianMap.getInteractions().pop();\n      simulationLayer.getSource().clear();\n      guardianMap.removeLayer(simulationLayer);\n    }\n\n    draw.on('drawend', function(evt: any) {\n      const feature = evt.feature;\n      const coords = feature.getGeometry().getCoordinates();\n      setFirstCoord(coords[0]);\n      const simulationData = coords.map((coordinate: any, index: number) => {\n        if (index !== 0) {\n          const heading = convertHeadingtoDegree(getRotation(coords[index - 1], coordinate));\n          const longLatCoord = convertCoord2LongLat(coordinate);\n          const timeStamp = formatDateTimeUTC(\n            moment(createdAtTime)\n              .add(increaseMinutes, 'minutes')\n              .toString(),\n            YYYY_MM_DD_HH_MM_SS,\n          );\n          const message = simulationFormatMessage({ heading, longLatCoord, timeStamp });\n          increaseMinutes += 5;\n\n          return message;\n        }\n      });\n\n      dispatch(BaseFunctions.setState({\n        field: \"selectedVessel\",\n        simulationRoutes: {\n          ...selectedVessel.simulationRoutes,\n          data: compact(simulationData),\n        },\n      }))\n\n      setCurrentFeature(feature);\n    });\n  }, [showSimulationRoutes, selectedVessel.name]);\n\n  useEffect(() => {\n    if (currentFeature && update) {\n      const source = simulationLayer.getSource();\n      const coords = SimulationRoutesData.map((record: any) => {\n        return convertLongLat2Coords([record.longitude, record.latitude]);\n      });\n      const updateCoords = [firstCoord].concat(coords);\n      const geometry = currentFeature.getGeometry();\n      geometry.setCoordinates(updateCoords);\n      source.clear();\n      source.addFeature(currentFeature);\n\n      const simulationData = geometry.getCoordinates().map((coordinate: any, index: number) => {\n        if (index !== 0) {\n          const heading = convertHeadingtoDegree(getRotation(updateCoords[index - 1], coordinate));\n          const longLatCoord = convertCoord2LongLat(coordinate);\n          const timeStamp = SimulationRoutesData[index - 1].timestamp;\n          const speed = SimulationRoutesData[index - 1].speed;\n          const created_at = SimulationRoutesData[index - 1].created_at;\n          const message = simulationFormatMessage({ heading, longLatCoord, timeStamp, speed, created_at });\n\n          return message;\n        }\n      });\n\n      dispatch(BaseFunctions.setState({\n        field: \"selectedVessel\",\n        simulationRoutes: {\n          ...selectedVessel.simulationRoutes,\n          update: !update,\n          data: compact(simulationData),\n        },\n      }))\n\n    }\n  }, [update]);\n\n  const handleClickClearDraw = () => {\n    guardianMap.getInteractions().pop();\n    guardianMap.addInteraction(draw);\n  };\n\n  const handleClickClearDrawLayer = () => {\n    simulationLayer.getSource().clear();\n\n    dispatch(BaseFunctions.setState({\n      field: \"selectedVessel\",\n      simulationRoutes: {\n        ...selectedVessel.simulationRoutes,\n        data: [],\n      },\n    }))\n  };\n\n  const handleClickSend = () => {\n    simulationLayer.getSource().clear();\n    guardianMap.removeLayer(simulationLayer);\n    guardianMap.addLayer(simulationLayer);\n    console.log(JSON.stringify(aisFakeMessage(SimulationRoutesData)));\n  \n    dispatch(BaseFunctions.setState({\n      field: \"selectedVessel\",\n      simulationRoutes: {\n        ...selectedVessel.simulationRoutes,\n        data: [],\n      },\n    }))\n    \n    setOpenDialog(false);\n  };\n\n  const handleCloseDialog = () => {\n    setOpenDialog(false);\n  };\n  const handleOpenDialog = () => {\n    setOpenDialog(true);\n  };\n  \n  return (\n    <>\n      <SimulationSettings\n        handleClickClearDraw={handleClickClearDraw}\n        handleClickClearDrawLayer={handleClickClearDrawLayer}\n        handleClickSend={handleOpenDialog}\n        show={showSimulationRoutes}\n      />\n      <Dialog\n        open={openDialog}\n        onClose={handleCloseDialog}\n        aria-labelledby=\"alert-dialog-title\"\n        aria-describedby=\"alert-dialog-description\"\n      >\n        <DialogTitle id=\"alert-dialog-title\">{'Create Simulation Data Confirmation?'}</DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-description\">\n            Please be aware that this simulation data will effect to voyage of current vessel, it is recommended to use\n            on a fake vessel which is not belong to our customer, will you continue?\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleCloseDialog} color=\"primary\">\n            Cancel\n          </Button>\n          <Button onClick={handleClickSend} color=\"primary\" autoFocus>\n            Send\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n}\n\nexport default Index\n"]},"metadata":{},"sourceType":"module"}